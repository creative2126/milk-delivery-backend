<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Maps</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .subscription-row {
            border: 1px solid #ddd;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
        }
        .map-link {
            color: #007bff;
            text-decoration: underline;
            margin-left: 10px;
        }
        .no-map {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Test Google Maps Button Display</h1>
        <p>This page tests if the Google Maps button displays correctly with location data.</p>
        <div id="subscriptions-container">
            Loading...
        </div>
    </div>

    <script>
        // Test data with location info
        const testSubscriptions = [
            {
                id: 1,
                username: "testuser1",
                subscription_type: "Daily Milk",
                duration: "30 days",
                amount: 1500,
                address: "123 Test Street",
                building_name: "Test Building",
                flat_number: "A-101",
                latitude: 19.0760,
                longitude: 72.8777,
                status: "active",
                created_at: "2024-01-15"
            },
            {
                id: 2,
                username: "testuser2",
                subscription_type: "Weekly Milk",
                duration: "7 days",
                amount: 350,
                address: "456 Another Street",
                building_name: "Another Building",
                flat_number: "B-202",
                latitude: null,
                longitude: null,
                status: "active",
                created_at: "2024-01-16"
            },
            {
                id: 3,
                username: "testuser3",
                subscription_type: "Monthly Milk",
                duration: "30 days",
                amount: 1200,
                address: "789 Third Street",
                building_name: "Third Building",
                flat_number: "C-303",
                latitude: 19.2183,
                longitude: 72.9781,
                status: "inactive",
                created_at: "2024-01-17"
            }
        ];

        function renderTestSubscriptions() {
            const container = document.getElementById('subscriptions-container');
            container.innerHTML = testSubscriptions.map(sub => `
                <div class="subscription-row">
                    <h3>Subscription #${sub.id} - ${sub.username}</h3>
                    <p><strong>Type:</strong> ${sub.subscription_type}</p>
                    <p><strong>Address:</strong> ${sub.address}, ${sub.building_name}, ${sub.flat_number}</p>
                    <p><strong>Location:</strong> ${sub.latitude || 'N/A'}, ${sub.longitude || 'N/A'}</p>
                    <p><strong>Status:</strong> ${sub.status}</p>
                    <p><strong>Google Maps Button:</strong> 
                        ${sub.latitude && sub.longitude && sub.latitude !== 'null' && sub.longitude !== 'null' ? 
                            `<a href="https://www.google.com/maps?q=${sub.latitude},${sub.longitude}" target="_blank" class="map-link">
                                <i class="fas fa-map-marker-alt"></i> View on Map
                            </a>` : 
                            '<span class="no-map">No location data</span>'
                        }
                    </p>
                </div>
            `).join('');
        }

        // Also test with real data
        async function loadRealData() {
            try {
                const response = await fetch('/api/admin/subscriptions');
                if (response.ok) {
                    const data = await response.json();
                    const realContainer = document.createElement('div');
                    realContainer.innerHTML = '<h2>Real Data Test</h2>';
                    
                    data.subscriptions.slice(0, 3).forEach(sub => {
                        const shouldShowMap = sub.latitude && sub.longitude && sub.latitude !== 'null' && sub.longitude !== 'null';
                        realContainer.innerHTML += `
                            <div class="subscription-row">
                                <h3>Real Subscription #${sub.id} - ${sub.username}</h3>
                                <p><strong>Location:</strong> ${sub.latitude || 'N/A'}, ${sub.longitude || 'N/A'}</p>
                                <p><strong>Google Maps Button:</strong> 
                                    ${shouldShowMap ? 
                                        `<a href="https://www.google.com/maps?q=${sub.latitude},${sub.longitude}" target="_blank" class="map-link">
                                            <i class="fas fa-map-marker-alt"></i> View on Map
                                        </a>` : 
                                        '<span class="no-map">No location data</span>'
                                    }
                                </p>
                            </div>
                        `;
                    });
                    container.appendChild(realContainer);
                }
            } catch (error) {
                console.error('Could not load real data:', error);
            }
        }

        renderTestSubscriptions();
        loadRealData();
    </script>
</body>
</html>
